import{_ as ke,h as Ce,c as _,r as p,ad as le,p as Te,a as r,b as a,j as i,k as u,l as y,f as k,i as $,n as T,F as D,d as A,t as l,ab as we,x as Ie,o as n,s as f,m as xe,a4 as H}from"./index-DwDg3_dR.js";const Ne={class:"message-center-page"},Se={class:"message-center-card"},$e={class:"type-tabs"},Be={class:"tabs-row"},Ve={class:"tab-label"},Me={class:"header-tools"},De={class:"message-center-main"},Ae={class:"left-panel"},Ue={key:0,class:"left-topbar"},Re={class:"sub-tabs",role:"tablist","aria-label":"我的消息子分类"},Le=["aria-selected"],Pe=["aria-selected"],ze={key:1,class:"conversation-list",role:"list"},Ke=["onClick"],Fe={class:"conversation-meta"},Xe={class:"meta-top"},Ye={class:"from-row"},je={class:"from-name"},Ee={class:"time"},He={class:"meta-bottom"},Je={class:"summary"},Oe={key:0,class:"list-empty"},We={key:2,class:"message-list",role:"list"},qe=["onClick"],Ge={class:"message-meta"},Qe={class:"meta-top"},Ze={class:"from-row"},et={class:"from-name"},tt={key:0,class:"sub-title"},st={class:"time"},at={class:"meta-bottom"},ot={class:"summary"},nt={key:0,class:"list-empty"},lt={class:"right-panel"},it={key:0,class:"chat"},rt={key:0,class:"chat-inner"},ct={class:"chat-header"},dt={class:"chat-peer"},ut={class:"chat-peer-meta"},vt={class:"chat-peer-name-row"},mt={class:"chat-peer-name"},_t={class:"chat-msg-main"},pt={class:"chat-bubble"},yt={class:"chat-text"},ht={class:"chat-time-out"},ft={class:"chat-input"},bt={class:"chat-send-row"},gt={key:1,class:"detail-empty"},kt={key:1},Ct={key:0,class:"detail"},Tt={class:"detail-header"},wt={class:"detail-title"},It={class:"detail-h2"},xt={class:"detail-sub"},Nt={class:"detail-from"},St={class:"detail-time"},$t={class:"detail-actions"},Bt={class:"detail-body"},Vt={class:"detail-content"},Mt={key:1,class:"detail-empty"},Dt={class:"new-chat-dialog"},At={class:"contact-list"},Ut=["onClick"],Rt={class:"contact-meta"},Lt={class:"contact-name-row"},Pt={class:"contact-name"},zt={class:"contact-desc"},Kt={__name:"index",setup(Ft){const S=Ce(),F={student:"学生",enterprise:"企业",teacher:"教师",admin:"管理员"},b=_(()=>({id:S.username||S.userInfo?.id||S.token||"me",name:S.username||"我",role:S.role||"student",avatar:S.avatar||""})),J=[{key:"my",label:"我的消息",icon:"Bell"},{key:"favorite",label:"收藏关注",icon:"Star"},{key:"comment",label:"评论",icon:"ChatLineRound"},{key:"reply",label:"回复",icon:"ChatDotRound"}],g=p("my"),w=p("private"),B=p(""),I=p(""),C=p(""),O=_(()=>g.value==="my"&&w.value==="private"),x=p({my:[{id:"my-1",fromName:"系统通知",subTitle:"官方",avatar:"",title:"欢迎使用人才揭榜系统",summary:"你的账号已完成初始化，快去完善个人资料吧。",content:`欢迎使用人才揭榜系统！

你可以在「个人中心」完善头像、简介、技能标签等信息，以便更快匹配项目与机会。`,timeText:"今天 09:12",unread:1},{id:"my-2",fromName:"项目助手",subTitle:"",avatar:"",title:"项目进度提醒",summary:"你参与的项目「电商平台前端开发」有新的里程碑更新。",content:`项目「电商平台前端开发」里程碑已更新。

建议你及时查看项目进度页，确认自己的任务与截止时间。`,timeText:"昨天 20:41",unread:0}],favorite:[{id:"fav-1",fromName:"你关注的发布方",subTitle:"",avatar:"",title:"发布方更新了项目需求",summary:"你关注的发布方更新了项目「AI智能客服系统开发」需求说明。",content:`你关注的发布方更新了项目「AI智能客服系统开发」的需求说明。

可前往项目详情查看最新版本，评估是否需要调整方案。`,timeText:"12-17 16:08",unread:2}],comment:[{id:"cmt-1",fromName:"张同学",subTitle:"",avatar:"",title:"有人评论了你的动态",summary:"“方案写得很清晰，期待你的最终交付！”",content:`张同学评论了你的动态：

“方案写得很清晰，期待你的最终交付！”

你可以进入相关页面查看上下文并进行互动。`,timeText:"12-16 11:32",unread:1}],reply:[{id:"rpl-1",fromName:"李同学",subTitle:"",avatar:"",title:"有人回复了你的评论",summary:"“我这边也遇到同样的问题，已按你说的解决。”",content:`李同学回复了你的评论：

“我这边也遇到同样的问题，已按你说的解决。”

你可以继续回复，或将该讨论整理到项目说明中。`,timeText:"12-15 18:20",unread:0}]}),X=_(()=>`tbs_private_chat_${b.value.id}`),c=p({conversations:[],messagesByConversationId:{}}),W=p([{id:"stu-1001",name:"王同学",role:"student",avatar:"",desc:"学生 · Web前端"},{id:"stu-1002",name:"李同学",role:"student",avatar:"",desc:"学生 · 数据分析"},{id:"ent-2001",name:"XX科技有限公司",role:"enterprise",avatar:"",desc:"企业 · 发布方"},{id:"ent-2002",name:"YY网络公司",role:"enterprise",avatar:"",desc:"企业 · 发布方"}]),U=p(!1),R=p(""),q=s=>{if(!s)return"";const e=new Date(s),o=new Date,d=e.getFullYear()===o.getFullYear()&&e.getMonth()===o.getMonth()&&e.getDate()===o.getDate(),v=N=>String(N).padStart(2,"0");return d?`${v(e.getHours())}:${v(e.getMinutes())}`:`${v(e.getMonth()+1)}-${v(e.getDate())}`},Y=()=>{const s=Date.now(),e={id:"conv-ent-2001",peerId:"ent-2001",peerName:"XX科技有限公司",peerRole:"enterprise",peerAvatar:"",lastMessage:"你好，我们想了解一下你的项目经验。",lastTime:s-1e3*60*40,unread:1},o={id:"conv-stu-1001",peerId:"stu-1001",peerName:"王同学",peerRole:"student",peerAvatar:"",lastMessage:"这周一起对一下需求文档？",lastTime:s-1e3*60*60*6,unread:0};return{conversations:[e,o],messagesByConversationId:{[e.id]:[{id:"m-1",fromId:e.peerId,content:"你好，我们想了解一下你的项目经验。",ts:s-1e3*60*40}],[o.id]:[{id:"m-2",fromId:o.peerId,content:"这周一起对一下需求文档？",ts:s-1e3*60*60*6},{id:"m-3",fromId:b.value.id,content:"可以的，我周五下午有空。",ts:s-1e3*60*60*5}]}}},ie=()=>{try{const s=localStorage.getItem(X.value);if(!s){c.value=Y();return}const e=JSON.parse(s);if(!e||typeof e!="object"){c.value=Y();return}c.value={conversations:Array.isArray(e.conversations)?e.conversations:[],messagesByConversationId:e.messagesByConversationId&&typeof e.messagesByConversationId=="object"?e.messagesByConversationId:{}}}catch{c.value=Y()}},re=()=>{try{localStorage.setItem(X.value,JSON.stringify(c.value))}catch{}};let L=null;const ce=()=>{L&&clearTimeout(L),L=setTimeout(()=>{re(),L=null},200)};le(X,()=>ie(),{immediate:!0}),le(c,()=>ce(),{deep:!0,flush:"post"});const P=_(()=>{const s=[...c.value.conversations||[]];return s.sort((e,o)=>(o.lastTime||0)-(e.lastTime||0)),s.map(e=>({...e,lastTimeText:q(e.lastTime)}))}),de=_(()=>{const s=R.value.trim().toLowerCase();return s?W.value.filter(e=>`${e.name} ${e.desc}`.toLowerCase().includes(s)):W.value}),G=_(()=>{const s={};for(const e of J)if(e.key==="my"){const o=(x.value.my||[]).reduce((v,N)=>v+(N.unread||0),0),d=P.value.reduce((v,N)=>v+(N.unread||0),0);s[e.key]=o+d}else{const o=x.value[e.key]||[];s[e.key]=o.reduce((d,v)=>d+(v.unread||0),0)}return s}),Q=_(()=>g.value==="my"?x.value.my||[]:x.value[g.value]||[]),Z=_(()=>{const s=Q.value,e=B.value.trim().toLowerCase();return e?s.filter(o=>`${o.title} ${o.summary} ${o.content}`.toLowerCase().includes(e)):s}),ee=_(()=>{const s=B.value.trim().toLowerCase();return s?P.value.filter(e=>`${e.peerName} ${e.lastMessage}`.toLowerCase().includes(s)):P.value}),h=_(()=>I.value&&Q.value.find(s=>s.id===I.value)||null),m=_(()=>C.value&&P.value.find(s=>s.id===C.value)||null),ue=_(()=>m.value?(c.value.messagesByConversationId[m.value.id]||[]).map(e=>({...e,timeText:q(e.ts)})):[]),ve=s=>{I.value=s},me=s=>{C.value=s;const e=c.value.conversations.findIndex(o=>o.id===s);e!==-1&&(c.value.conversations[e].unread=0),H(()=>j())},te=s=>{w.value=s,I.value="",C.value=""},_e=()=>{B.value="",I.value="",C.value=""},pe=()=>{if(!h.value)return;const e=(x.value[g.value]||[]).find(o=>o.id===h.value.id);e&&(e.unread=0)},ye=()=>{if(!h.value)return;const s=x.value[g.value]||[];x.value[g.value]=s.filter(e=>e.id!==h.value.id),I.value=""},se=p(),V=p(""),j=()=>{const s=se.value;s&&(s.scrollTop=s.scrollHeight)},he=()=>{R.value="",U.value=!0},fe=s=>{const e=c.value.conversations.find(o=>o.peerId===s.id);if(e)C.value=e.id;else{const o=Date.now(),d=`conv-${s.id}`;c.value.conversations.unshift({id:d,peerId:s.id,peerName:s.name,peerRole:s.role,peerAvatar:s.avatar||"",lastMessage:"已建立会话",lastTime:o,unread:0}),c.value.messagesByConversationId[d]=[{id:`m-${o}`,fromId:b.value.id,content:"你好，很高兴认识你！",ts:o}],C.value=d}U.value=!1,H(()=>j())},ae=()=>{if(!m.value)return;const s=V.value.trim();if(!s)return;const e=Date.now(),o=m.value.id;c.value.messagesByConversationId[o]||(c.value.messagesByConversationId[o]=[]),c.value.messagesByConversationId[o].push({id:`m-${e}`,fromId:b.value.id,content:s,ts:e});const d=c.value.conversations.findIndex(v=>v.id===o);d!==-1&&(c.value.conversations[d].lastMessage=s,c.value.conversations[d].lastTime=e),V.value="",H(()=>j())};return Te(()=>{}),(s,e)=>{const o=y("el-icon"),d=y("el-badge"),v=y("el-tab-pane"),N=y("el-tabs"),oe=y("Search"),E=y("el-input"),be=y("Plus"),z=y("el-button"),M=y("el-avatar"),K=y("el-empty"),ge=y("el-dialog");return n(),r("div",Ne,[a("div",Se,[a("div",$e,[a("div",Be,[i(N,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=t=>g.value=t),onTabChange:_e},{default:u(()=>[(n(),r(D,null,A(J,t=>i(v,{key:t.key,name:t.key},{label:u(()=>[a("span",Ve,[i(o,{class:"tab-icon"},{default:u(()=>[(n(),$(xe(t.icon)))]),_:2},1024),f(" "+l(t.label)+" ",1),G.value[t.key]>0?(n(),$(d,{key:0,value:G.value[t.key],class:"tab-badge"},null,8,["value"])):k("",!0)])]),_:2},1032,["name"])),64))]),_:1},8,["modelValue"]),a("div",Me,[i(E,{modelValue:B.value,"onUpdate:modelValue":e[1]||(e[1]=t=>B.value=t),placeholder:"搜索消息内容",clearable:"",class:"search-input"},{prefix:u(()=>[i(o,null,{default:u(()=>[i(oe)]),_:1})]),_:1},8,["modelValue"])])])]),a("section",De,[a("aside",Ae,[g.value==="my"?(n(),r("div",Ue,[a("div",Re,[a("button",{type:"button",class:T(["sub-tab-btn",{active:w.value==="private"}]),role:"tab","aria-selected":w.value==="private",onClick:e[2]||(e[2]=t=>te("private"))}," 私信 ",10,Le),a("button",{type:"button",class:T(["sub-tab-btn",{active:w.value==="notice"}]),role:"tab","aria-selected":w.value==="notice",onClick:e[3]||(e[3]=t=>te("notice"))}," 系统通知 ",10,Pe)]),w.value==="private"?(n(),$(z,{key:0,type:"primary",class:"new-chat-btn",onClick:he},{default:u(()=>[i(o,null,{default:u(()=>[i(be)]),_:1}),e[7]||(e[7]=f(" 发起私信 ",-1))]),_:1})):k("",!0)])):k("",!0),O.value?(n(),r("div",ze,[(n(!0),r(D,null,A(ee.value,t=>(n(),r("div",{key:t.id,class:T(["conversation-item",{active:t.id===C.value}]),role:"listitem",onClick:ne=>me(t.id)},[i(M,{size:44,src:t.peerAvatar,class:"message-avatar"},{default:u(()=>[f(l(t.peerName?.slice(0,1)||"U"),1)]),_:2},1032,["src"]),a("div",Fe,[a("div",Xe,[a("div",Ye,[a("span",je,l(t.peerName),1),a("span",{class:T(["role-tag",t.peerRole])},l(F[t.peerRole]||"用户"),3)]),a("span",Ee,l(t.lastTimeText),1)]),a("div",He,[a("p",Je,l(t.lastMessage),1),t.unread>0?(n(),$(d,{key:0,value:t.unread,class:"unread-badge"},null,8,["value"])):k("",!0)])])],10,Ke))),128)),ee.value.length?k("",!0):(n(),r("div",Oe,[i(K,{description:"暂无私信会话"})]))])):(n(),r("div",We,[(n(!0),r(D,null,A(Z.value,t=>(n(),r("div",{key:t.id,class:T(["message-item",{active:t.id===I.value}]),role:"listitem",onClick:ne=>ve(t.id)},[i(M,{size:44,src:t.avatar,class:"message-avatar"},{default:u(()=>[f(l(t.fromName?.slice(0,1)||"U"),1)]),_:2},1032,["src"]),a("div",Ge,[a("div",Qe,[a("div",Ze,[a("span",et,l(t.fromName),1),t.subTitle?(n(),r("span",tt,l(t.subTitle),1)):k("",!0)]),a("span",st,l(t.timeText),1)]),a("div",at,[a("p",ot,l(t.summary),1),t.unread>0?(n(),$(d,{key:0,value:t.unread,class:"unread-badge"},null,8,["value"])):k("",!0)])])],10,qe))),128)),Z.value.length?k("",!0):(n(),r("div",nt,[i(K,{description:"暂无消息"})]))]))]),a("main",lt,[O.value?(n(),r("div",it,[m.value?(n(),r("div",rt,[a("div",ct,[a("div",dt,[i(M,{size:40,src:m.value.peerAvatar,class:"chat-avatar"},{default:u(()=>[f(l(m.value.peerName?.slice(0,1)||"U"),1)]),_:1},8,["src"]),a("div",ut,[a("div",vt,[a("span",mt,l(m.value.peerName),1),a("span",{class:T(["role-tag",m.value.peerRole])},l(F[m.value.peerRole]||"用户"),3)]),e[8]||(e[8]=a("span",{class:"chat-peer-tip"},"在这里可以和企业/同学进行私信交流",-1))])])]),a("div",{ref_key:"chatScroller",ref:se,class:"chat-scroller"},[(n(!0),r(D,null,A(ue.value,t=>(n(),r("div",{key:t.id,class:T(["chat-msg-row",{me:t.fromId===b.value.id}])},[i(M,{size:32,src:t.fromId===b.value.id?b.value.avatar:m.value.peerAvatar,class:"chat-msg-avatar"},{default:u(()=>[f(l((t.fromId===b.value.id?b.value.name:m.value.peerName)?.slice(0,1)),1)]),_:2},1032,["src"]),a("div",_t,[a("div",pt,[a("div",yt,l(t.content),1)]),a("div",ht,l(t.timeText),1)])],2))),128))],512),a("div",ft,[i(E,{modelValue:V.value,"onUpdate:modelValue":e[4]||(e[4]=t=>V.value=t),type:"textarea",rows:2,class:"chat-textarea",placeholder:"输入消息，Enter 发送，Shift+Enter 换行",onKeydown:we(Ie(ae,["exact","prevent"]),["enter"])},null,8,["modelValue","onKeydown"]),a("div",bt,[i(z,{type:"primary",disabled:!V.value.trim(),onClick:ae},{default:u(()=>[...e[9]||(e[9]=[f(" 发送 ",-1)])]),_:1},8,["disabled"])])])])):(n(),r("div",gt,[i(K,{description:"请选择左侧一个会话开始聊天"})]))])):(n(),r("div",kt,[h.value?(n(),r("div",Ct,[a("div",Tt,[a("div",wt,[a("h2",It,l(h.value.title),1),a("div",xt,[a("span",Nt,"来自："+l(h.value.fromName),1),e[10]||(e[10]=a("span",{class:"detail-sep"},"·",-1)),a("span",St,l(h.value.timeText),1)])]),a("div",$t,[h.value.unread>0?(n(),$(z,{key:0,type:"primary",onClick:pe},{default:u(()=>[...e[11]||(e[11]=[f(" 标记已读 ",-1)])]),_:1})):k("",!0),i(z,{type:"danger",plain:"",onClick:ye},{default:u(()=>[...e[12]||(e[12]=[f(" 删除 ",-1)])]),_:1})])]),a("div",Bt,[a("p",Vt,l(h.value.content),1)])])):(n(),r("div",Mt,[i(K,{description:"请选择左侧一条消息查看详情"})]))]))])])]),i(ge,{modelValue:U.value,"onUpdate:modelValue":e[6]||(e[6]=t=>U.value=t),title:"发起私信",width:"420px"},{default:u(()=>[a("div",Dt,[i(E,{modelValue:R.value,"onUpdate:modelValue":e[5]||(e[5]=t=>R.value=t),clearable:"",placeholder:"搜索联系人（学生/企业）"},{prefix:u(()=>[i(o,null,{default:u(()=>[i(oe)]),_:1})]),_:1},8,["modelValue"]),a("div",At,[(n(!0),r(D,null,A(de.value,t=>(n(),r("button",{key:t.id,type:"button",class:"contact-item",onClick:ne=>fe(t)},[i(M,{size:40,src:t.avatar,class:"contact-avatar"},{default:u(()=>[f(l(t.name?.slice(0,1)||"U"),1)]),_:2},1032,["src"]),a("div",Rt,[a("div",Lt,[a("span",Pt,l(t.name),1),a("span",{class:T(["role-tag",t.role])},l(F[t.role]||"用户"),3)]),a("span",zt,l(t.desc),1)])],8,Ut))),128))])])]),_:1},8,["modelValue"])])}}},Yt=ke(Kt,[["__scopeId","data-v-63f3b59b"]]);export{Yt as default};
