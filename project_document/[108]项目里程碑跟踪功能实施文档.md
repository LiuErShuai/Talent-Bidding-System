# 项目里程碑跟踪功能实施文档

## ✅ 实施完成状态

**实施日期**: 2025-01-XX  
**实施状态**: ✅ 已完成  
**文件路径**: `Talent-Bidding-System-master/src/views/project/Detail/index.vue`

---

## 📋 功能概述

在项目详情页面添加了"项目里程碑"标签页，用于发布方和承接方追踪项目的进度信息。该功能支持：

1. **信息展示**：展示项目的各个里程碑节点信息
2. **权限控制**：部分敏感信息仅对项目参与者（发布方和承接方）显示
3. **状态跟踪**：显示里程碑的完成状态、时间信息、交付物等
4. **纯展示功能**：不包含操作功能（提交作品等操作在其他界面执行）

---

## 🎯 功能特点

### 1. 权限控制机制

**项目参与者定义**：
- **发布方**：项目的企业发布方（`role === 'enterprise'` 且 `userId === project.publisherId`）
- **承接方**：揭榜承接项目的学生/团队（`role === 'student'` 且 `userId` 在 `project.bidderIds` 列表中）

**信息分级**：
- **公开信息**：所有用户可见
  - 里程碑标题和描述
  - 计划时间和实际完成时间
  - 交付物列表
  - 里程碑状态（已完成/进行中/待开始/已延迟）

- **敏感信息**：仅项目参与者可见
  - 详细进度信息（进度百分比、进度说明）
  - 内部沟通记录（发布方和承接方的沟通内容）
  - 内部备注（项目内部的工作备注）
  - 内部附件（项目内部文档）

### 2. 里程碑状态

支持四种状态：
- **已完成** (`completed`)：里程碑已完成，显示绿色标记和成功标签
- **进行中** (`in-progress`)：里程碑正在进行，显示蓝色标记和警告标签，带脉冲动画
- **待开始** (`pending`)：里程碑尚未开始，显示灰色标记和信息标签
- **已延迟** (`delayed`)：里程碑已延迟，显示红色标记和危险标签

### 3. UI设计

**时间轴布局**：
- 垂直时间轴展示所有里程碑
- 每个里程碑使用卡片式设计
- 左侧显示状态标记（对勾/圆点）
- 连接线显示进度状态（已完成部分为绿色，未完成部分为灰色）

**视觉反馈**：
- 不同状态使用不同颜色标识
- 卡片悬停效果
- 敏感信息区域使用特殊样式和锁图标标识
- 响应式设计，支持移动端

---

## 🔧 技术实现

### 数据结构

#### 里程碑数据模型

```javascript
{
  id: 'milestone-1',                    // 里程碑ID
  title: '项目启动会',                    // 里程碑标题
  description: '项目正式启动...',         // 里程碑描述（公开）
  status: 'completed',                   // 状态：'completed' | 'in-progress' | 'pending' | 'delayed'
  plannedDate: '2025-11-16',             // 计划日期
  actualDate: '2025-11-16',              // 实际完成日期（可选）
  delayDays: 0,                          // 延迟天数（负数表示提前）
  deliverables: ['文档1', '文档2'],      // 交付物列表（公开）
  
  // 以下为敏感信息，仅项目参与者可见
  progressDetail: {                      // 详细进度信息
    percentage: 100,
    status: 'success',
    note: '进度说明'
  },
  communications: [                      // 沟通记录
    {
      author: '作者',
      time: '2025-11-16 14:30',
      content: '沟通内容'
    }
  ],
  internalNotes: '内部备注内容',          // 内部备注
  sensitiveAttachments: [                // 内部附件
    { name: '文件名', size: '大小' }
  ]
}
```

#### 项目数据模型（扩展）

```javascript
{
  publisherId: 'enterprise-001',         // 发布方ID
  bidderIds: ['student-001', 'student-002'] // 承接方ID列表
}
```

### 权限判断逻辑

```javascript
// 从store获取当前用户信息
const currentUser = computed(() => {
  return {
    id: authStore.userInfo?.id || '',
    role: authStore.userRole || 'visitor',
    isLoggedIn: authStore.isAuthenticated
  }
})

// 判断是否是项目参与者
const isProjectParticipant = computed(() => {
  if (!currentUser.value.isLoggedIn) return false
  
  const userId = currentUser.value.id
  const userRole = currentUser.value.role
  
  // 判断是否是发布方
  if (userRole === 'enterprise' && userId === project.value.publisherId) {
    return true
  }
  
  // 判断是否是承接方
  if (userRole === 'student' && project.value.bidderIds?.includes(userId)) {
    return true
  }
  
  return false
})
```

### 组件导入

```javascript
import { useAuthStore } from '@/store/modules/auth'
import { Calendar, Lock } from '@element-plus/icons-vue'
```

---

## 📝 代码位置说明

### HTML模板部分

**代码标记**: `PROJECT_MILESTONE_TRACKING_SECTION`

**位置**: 在 `<el-tabs>` 内部，`<el-tab-pane label="企业介绍">` 之后

**搜索关键词**: `PROJECT_MILESTONE_TRACKING_SECTION`

### 脚本部分

**代码标记**: `PROJECT_MILESTONE_TRACKING_DATA`

**位置**: 在 `<script setup>` 中，`projectSteps` 数据定义之后

**搜索关键词**: `PROJECT_MILESTONE_TRACKING_DATA`

### 样式部分

**代码标记**: `PROJECT_MILESTONE_TRACKING_STYLES`

**位置**: 在 `<style scoped>` 中，`.tab-content` 样式之后

**搜索关键词**: `PROJECT_MILESTONE_TRACKING_STYLES`

---

## 🎨 UI展示效果

### 访客视图（非项目参与者）

```
┌─────────────────────────────────────────┐
│ ℹ️ 您当前以访客身份查看，部分敏感信息仅对  │
│   项目参与者（发布方和承接方）可见        │
└─────────────────────────────────────────┘

✓ 项目启动会                    [已完成]
  2025-11-16
  项目正式启动，明确项目目标...
  
  交付物：
  • 项目启动会议纪要
  • 项目计划书
  
  ┌─────────────────────────────────────┐
  │ ℹ️ 此里程碑包含项目参与者专属信息... │
  └─────────────────────────────────────┘
```

### 项目参与者视图

```
✓ 项目启动会                    [已完成]
  2025-11-16  实际完成：2025-11-16
  项目正式启动，明确项目目标...
  
  交付物：
  • 项目启动会议纪要
  • 项目计划书
  
  ─────────────────────────────────────
  🔒 项目参与者信息
  ─────────────────────────────────────
  
  详细进度：
  ████████████████████ 100%
  会议顺利召开，所有团队成员参与...
  
  沟通记录：
  ┌─────────────────────────────────┐
  │ 李经理（企业方）  2025-11-16 14:30│
  │ 项目启动顺利，期待团队的表现      │
  └─────────────────────────────────┘
  
  内部备注：
  项目启动顺利，团队积极性高...
  
  内部附件：
  • 项目启动会录音.mp3 (12.5MB) [下载]
  • 内部讨论记录.docx (856KB) [下载]
```

---

## 🔄 后续接入后端步骤

### 步骤1: 创建API函数

在 `src/api/project.js` 中添加：

```javascript
/**
 * 获取项目里程碑信息
 * @param {String} projectId - 项目ID
 * @returns {Promise} 项目里程碑数据
 */
export const getProjectMilestones = async (projectId) => {
  return await request.get(`/api/projects/${projectId}/milestones`)
}

/**
 * 获取项目基本信息（包括发布方和承接方信息）
 * @param {String} projectId - 项目ID
 * @returns {Promise} 项目基本信息
 */
export const getProjectInfo = async (projectId) => {
  return await request.get(`/api/projects/${projectId}`)
}
```

### 步骤2: 实现数据格式化函数

```javascript
/**
 * 格式化里程碑数据
 * @param {Array} apiData - API返回的里程碑数据
 * @returns {Array} 格式化后的里程碑数据
 */
const formatMilestones = (apiData) => {
  return apiData.map(milestone => {
    // 计算延迟天数
    let delayDays = null
    if (milestone.actualDate && milestone.plannedDate) {
      const planned = new Date(milestone.plannedDate)
      const actual = new Date(milestone.actualDate)
      delayDays = Math.floor((actual - planned) / (1000 * 60 * 60 * 24))
    }
    
    return {
      id: milestone.id,
      title: milestone.title,
      description: milestone.description,
      status: milestone.status, // 'completed' | 'in-progress' | 'pending' | 'delayed'
      plannedDate: milestone.plannedDate,
      actualDate: milestone.actualDate || null,
      delayDays: delayDays,
      deliverables: milestone.deliverables || [],
      // 敏感信息（仅项目参与者可见）
      progressDetail: milestone.progressDetail || null,
      communications: milestone.communications || [],
      internalNotes: milestone.internalNotes || null,
      sensitiveAttachments: milestone.sensitiveAttachments || []
    }
  })
}
```

### 步骤3: 在组件中调用API

```javascript
// 加载项目里程碑数据
const loadMilestones = async (projectId) => {
  try {
    const response = await getProjectMilestones(projectId)
    milestones.value = formatMilestones(response.data)
  } catch (error) {
    console.error('加载项目里程碑失败:', error)
    ElMessage.error('加载项目里程碑失败，请稍后重试')
  }
}

// 加载项目基本信息
const loadProjectInfo = async (projectId) => {
  try {
    const response = await getProjectInfo(projectId)
    project.value.publisherId = response.data.publisherId
    project.value.bidderIds = response.data.bidderIds || []
  } catch (error) {
    console.error('加载项目信息失败:', error)
  }
}
```

### 步骤4: 在 onMounted 中调用

```javascript
onMounted(() => {
  const projectId = route.params.id
  if (projectId) {
    loadProjectInfo(projectId)
    loadMilestones(projectId)
    loadProjectSteps(projectId)
  }
})
```

---

## 📊 后端API接口设计建议

### 接口1: 获取项目里程碑列表

**请求**:
```
GET /api/projects/:projectId/milestones
```

**响应**:
```json
{
  "code": 200,
  "data": [
    {
      "id": "milestone-1",
      "title": "项目启动会",
      "description": "项目正式启动...",
      "status": "completed",
      "plannedDate": "2025-11-16",
      "actualDate": "2025-11-16",
      "deliverables": ["文档1", "文档2"],
      "progressDetail": {
        "percentage": 100,
        "status": "success",
        "note": "进度说明"
      },
      "communications": [
        {
          "author": "作者",
          "time": "2025-11-16 14:30",
          "content": "沟通内容"
        }
      ],
      "internalNotes": "内部备注",
      "sensitiveAttachments": [
        {
          "name": "文件名",
          "size": "大小",
          "url": "下载地址"
        }
      ]
    }
  ]
}
```

**权限说明**:
- 所有用户都可以获取里程碑列表
- 但响应中的 `progressDetail`、`communications`、`internalNotes`、`sensitiveAttachments` 字段需要根据用户权限决定是否返回
- 如果用户不是项目参与者，这些敏感字段应返回 `null` 或空数组

---

## ✅ 测试清单

### 功能测试

- [x] 里程碑列表正确显示
- [x] 里程碑状态正确展示（已完成/进行中/待开始/已延迟）
- [x] 时间信息正确显示（计划时间、实际完成时间、延迟天数）
- [x] 交付物列表正确显示
- [x] 权限控制正确（非参与者不显示敏感信息）
- [x] 敏感信息区域正确显示/隐藏
- [x] 访客提示信息正确显示
- [x] 空状态处理（无里程碑时显示空状态）

### 权限测试

- [x] 未登录用户：不显示敏感信息
- [x] 访客用户：不显示敏感信息
- [x] 发布方：显示完整信息（包括敏感信息）
- [x] 承接方：显示完整信息（包括敏感信息）
- [x] 其他用户：不显示敏感信息

### UI测试

- [x] 时间轴布局正确
- [x] 里程碑卡片样式正确
- [x] 状态标记正确显示（对勾/圆点/脉冲动画）
- [x] 连接线颜色正确（已完成为绿色，未完成为灰色）
- [x] 敏感信息区域样式正确（锁图标、分隔线）
- [x] 响应式设计正常（移动端适配）

### 代码质量

- [x] 代码注释完整
- [x] 代码结构清晰
- [x] 无控制台错误
- [x] 无样式冲突
- [x] 无Lint错误

---

## 🎉 总结

本次实施成功完成了以下内容：

1. ✅ **里程碑跟踪标签页**：添加了新的标签页用于展示项目里程碑信息
2. ✅ **权限控制机制**：实现了敏感信息的权限控制，仅项目参与者可见
3. ✅ **状态展示**：支持四种里程碑状态的可视化展示
4. ✅ **时间轴设计**：使用时间轴布局清晰展示项目进度
5. ✅ **数据预留**：为后续接入后端API做好了充分准备

**当前状态**: 静态原型已完成，等待后端API接入后即可实现动态数据展示。

**设计理念**: 
- 纯信息展示，不包含操作功能
- 清晰的权限分级，保护项目敏感信息
- 直观的可视化设计，便于跟踪项目进度

---

**文档结束**

