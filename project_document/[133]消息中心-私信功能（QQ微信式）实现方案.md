# 背景与目标

- **背景**：消息中心已具备“分类导航 + 左列表 + 右详情”的基础结构，但缺少“私信”能力。用户希望学生能够与企业/其他学生进行私信交流，交互类似 QQ/微信。
- **目标**：在“我的消息”分类下新增“私信”子模块，实现会话列表 + 聊天窗口 + 发送消息 + 发起私信（选择联系人）等基础能力，并为后续接入后端 API / WebSocket 预留数据模型。

## 目录

1. 需求与验收标准
2. 现状与约束
3. 方案选型（至少两种）
4. 数据模型（前端/后端对接预留）
5. 详细 Todolist（时间戳原则）
6. 风险与回滚

## 1. 需求与验收标准

- 私信入口位于消息中心“我的消息”下，并可在“私信/系统通知”之间切换。
- 私信交互类似 QQ/微信：
  - 左侧：会话列表（支持按顶部搜索框过滤）。
  - 右侧：聊天窗口（消息气泡、滚动区、输入框、发送按钮）。
- 学生可以与企业、其他学生发起私信会话（MVP 通过联系人列表模拟）。
- 可用性验收：
  - 新建会话后可进入聊天；
  - 发送消息后会话的最后一条消息与时间更新；
  - 点击会话会清空该会话未读数（MVP 可通过模拟数据验证）。

## 2. 现状与约束

- 技术栈：Vue 3 + Vite + Element Plus；图标已全局注册。
- 当前 `src/views/message/MessageCenter/index.vue` 采用 Element Plus Tabs + 双栏布局，数据为 mock。
- 当前无后端消息 API 与 WebSocket 接入约定（需预留扩展点）。
- 约束：不新增测试文件；完成后需更新 `project_document/[000]功能模块文档.md`；需要记录关键决策（用 `project_document/[131]交互记忆台账.md` 替代 memory MCP）。

## 3. 方案选型（至少两种）

### 方案 A：前端 mock + localStorage 持久化（本次采用）

- **做法**：在消息中心页面内部实现私信模块；会话与消息存入 localStorage（按当前登录用户隔离）。
- **优点**：无需后端即可演示完整交互闭环；开发快；便于后续替换为真实 API。
- **缺点**：无法实现多端同步/真实未读；无法跨用户互发（仅本地模拟）。

### 方案 B：后端 API + WebSocket 实时通信（后续迭代）

- **做法**：HTTP 获取会话列表/历史记录，WebSocket 推送新消息与未读更新；发送消息走 HTTP 或 WS。
- **优点**：体验接近真实 IM；支持多端同步、离线消息、已读/未读准确。
- **缺点**：需要后端配合与协议设计；开发与联调成本更高。

## 4. 数据模型（前端/后端对接预留）

### 会话 Conversation（建议字段）

- `id`：会话 id（后端生成）
- `peerId`：对方用户 id
- `peerRole`：对方角色（student/enterprise）
- `lastMessage`：最后一条消息摘要
- `lastTime`：最后更新时间（时间戳）
- `unread`：未读数

### 消息 Message（建议字段）

- `id`：消息 id
- `conversationId`：所属会话 id
- `fromId`：发送者 id
- `content`：文本内容
- `ts`：发送时间戳
- （扩展）`type`：text/image/file 等；`extra`：附件信息

## 5. 详细 Todolist（时间戳原则）

- 2025-12-18 19:37：R 阶段：明确需求与验收：在“我的消息”下新增私信，会话列表+聊天窗口+发送+发起私信。
- 2025-12-18 19:45：I 阶段：评估方案 A/B，确定本次采用方案 A（前端 mock + localStorage）。
- 2025-12-18 19:55：P 阶段：落地实现步骤与数据模型，形成本文件。
- 2025-12-18 19:43：E 阶段：
  - [x] 改造 `src/views/message/MessageCenter/index.vue`：加入“私信/系统通知”子切换与私信 UI。
  - [x] 新增联系人弹窗：支持选择企业/学生发起会话。
  - [x] 支持发送消息与滚动到底部。
  - [x] 私信数据存入 localStorage（按用户隔离）。
- 2025-12-18 19:44：[x] 文档同步：更新 `project_document/[000]功能模块文档.md` 与 `project_document/[131]交互记忆台账.md`。
- 2025-12-18 19:50：[ ] 自检：切换/搜索/发起会话/发送消息；如需运行 `npm run build`（会重写 `dist/`），需先征得许可。
- 2025-12-18 19:55：[ ] Git 提交：创建一次聚焦提交记录本次“私信功能”改动。

## 6. 风险与回滚

- 风险：私信与通知共用顶部搜索框，用户可能混淆过滤对象。
  - 处理：后续可在私信模式下将 placeholder 改为“搜索联系人/聊天内容”。
- 风险：本地 mock 无法体现真实互发与未读推送。
  - 处理：后续通过方案 B 接入 WebSocket 实现真实推送。
- 回滚：本次主要修改单页面与文档记录，可通过 `git revert` 单提交回滚。
