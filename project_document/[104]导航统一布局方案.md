# 导航统一布局方案（方案A实施计划）

- **背景与目标**：当前导航组件与页面实现割裂，导致不同角色导航不一致。本方案以 Layout 为核心统一导航，确保学生/企业/教师/管理员均可按角色获得正确菜单，并为后续全局能力（消息、公告等）提供挂载点。
- **编写时间**：2025-11-24

## 目录
1. 需求与验收标准
2. 技术方案摘要
3. 实施步骤与责任划分
4. 风险与缓解措施
5. TodoList（执行清单）

## 1. 需求与验收标准
- 必须通过 Layout 统一渲染 `AppHeader`/`AppFooter`，页面内不再手写导航。
- 导航内容需按用户角色切换，至少覆盖游客/学生/企业/教师/管理员五类。
- 登录状态与角色读取统一交由 Pinia `authStore`，任何页面不再自行维护重复状态。
- 现有 `Home`、`Student`、`Enterprise`、`Admin` 模块在方案完成后视觉上与当前一致，功能可回归。
- 新增路由或页面只需选择布局即可自动获得正确导航。

## 2. 技术方案摘要
- **Layout 驱动**：公共页面挂载 `DefaultLayout`，管理端挂载 `AdminLayout`（如有需要可扩展 `RoleLayout`）。Layout 内部从 Pinia 读取角色/登录态，并将导航配置传给 `AppHeader`。
- **导航配置**：新增 `src/utils/navConfig.js`（或同级 constants），集中描述各角色的菜单树、路由路径、权限要求，并支持分组/下拉定义。
- **组件升级**：
  - `AppHeader` 接收 `navItems`、`extraActions`、`showAuthArea` 等 props，通过统一样式渲染多层菜单；保留现有消息/登录入口逻辑。
  - `UserPanel` 扩展为根据角色显示不同的快捷入口（如“我的项目”“项目发布”“后台管理”）。
- **路由改造**：以角色模块为单位（student/enterprise/teacher/admin/common），在 `router/modules/*` 内包装 Layout，对外只暴露页面组件。
- **样式治理**：统一 `.main-header` `.nav-link` 等样式至组件 scope，删除页面内重复 CSS，必要时添加 BEM 修饰符以支持不同场景（例如首页透明背景）。

## 3. 实施步骤与责任划分
1. **Baseline 整理**（负责人：LD）
   - 梳理目前哪些页面仍手写 header，记录清单。
   - 排查 Layout 是否有未使用的依赖/样式，清理无用代码。
2. **导航配置与类型定义**（AR）
   - 创建 `navConfig`，定义角色枚举、菜单类型、受保护标记。
   - 提供获取函数 `getNavByRole(role, isLoggedIn)`。
3. **组件升级**（LD）
   - 重构 `AppHeader` 为完全基于配置渲染，加入 props 校验与必要中文注释。
   - 扩展 `UserPanel` 动态入口、登出回调。
   - 补充必要的全局样式变量（如 header 高度）。
4. **Layout 接入**（LD）
   - 更新 `DefaultLayout`/`AdminLayout`，通过 `computed` 获取角色导航，向下传递 props。
   - 预留 slot 以支持特殊页面（如首页）自定义顶部背景。
5. **路由批量接入**（PM/LD）
   - 逐个模块将页面路由改为 Layout 包裹，删除页面内部 header 代码。
   - 特殊页面（登录/注册等）可保持空布局。
6. **页面样式回归**（PDM）
   - 根据清单比对 Home、学生页、企业页、管理员页视觉，与设计稿对齐。
   - 调整余下 scoped 样式以适配新结构。
7. **联调与文档**（DW）
   - 记录导航配置规范，更新 `[000]功能模块文档.md`。
   - 产出手工验证清单，确保角色切换表现正确。

## 4. 风险与缓解措施
- **路由切换影响范围大**：按照模块分支逐步上线，先在测试环境验证；保留旧页面副本直至验收完成。
- **角色数据缺失**：若后端未返回角色，可通过本地 mock/默认映射临时支持，但需在 `authStore` 中增加 fallback 提示。
- **样式回归量大**：定义统一变量与 mixin，减少重复改动；对首页等特殊场景引入 `variant` prop 控制。

## 5. TodoList（执行清单）
1. 梳理需要接入 Layout 的页面清单，标记优先级与依赖（进行中）。
2. 设计并落地 `navConfig` 数据结构，包含角色/分组/权限信息。
3. 重构 `AppHeader` 与 `UserPanel`，支持配置化导航与角色入口。
4. 调整 `DefaultLayout`、`AdminLayout` 逻辑，统一注入导航。
5. 批量更新各模块路由与页面，删除重复 header，回归样式。
6. 编写验证脚本/手工测试用例，覆盖五类角色导航。
7. 更新 `[000]功能模块文档.md` 与相关变更记录，准备 Git 提交。

