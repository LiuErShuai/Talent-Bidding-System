# 个人主页资料显示代码提取 - 用户头部和设置组件

## 2. UserHeader.vue - 用户头部信息组件

从 `AppHeader.vue` 中提取的用户信息显示部分，包含用户头像、名称和下拉菜单。

### 完整源代码

```vue
<template>
  <!-- 用户菜单 -->
  <el-dropdown class="user-dropdown" trigger="click">
    <div class="user-avatar">
      <el-avatar
        :size="32"
        :src="user.avatar"
      />
      <span class="user-name">{{ user.name || user.username }}</span>
      <i class="fas fa-chevron-down"></i>
    </div>
    <template #dropdown>
      <el-dropdown-menu>
        <el-dropdown-item @click="$router.push('/profile')">
          <i class="fas fa-user mr-2"></i>
          个人资料
        </el-dropdown-item>
        <el-dropdown-item @click="$router.push('/settings')">
          <i class="fas fa-cog mr-2"></i>
          设置
        </el-dropdown-item>
        <el-dropdown-item divided @click="handleLogout">
          <i class="fas fa-sign-out-alt mr-2"></i>
          退出登录
        </el-dropdown-item>
      </el-dropdown-menu>
    </template>
  </el-dropdown>
</template>

<script setup>
import { computed } from 'vue'
import { useRouter } from 'vue-router'
import { useAuthStore } from '@/composables/useAuth'
import { ElMessage } from 'element-plus'

// 状态管理
const authStore = useAuthStore()
const router = useRouter()

// 计算属性
const user = computed(() => authStore.user)

// 方法
const handleLogout = async () => {
  const result = await authStore.logout()
  if (result.success) {
    ElMessage.success('退出登录成功')
    router.push('/login')
  }
}
</script>

<style scoped>
.user-dropdown {
  cursor: pointer;
}

.user-avatar {
  display: flex;
  align-items: center;
  padding: var(--spacing-sm);
  border-radius: var(--border-radius);
  transition: background-color var(--transition-normal);
}

.user-avatar:hover {
  background-color: rgba(24, 144, 255, 0.05);
}

.user-name {
  margin: 0 var(--spacing-sm);
  font-weight: 500;
}

.user-avatar i {
  color: var(--text-color-secondary);
  font-size: var(--font-size-xs);
}

/* 响应式设计 */
@media (max-width: 767px) {
  .user-name {
    display: none;
  }
}
</style>
```

## 3. SettingsForm.vue - 设置表单组件

从 `Settings.vue` 中提取的个人信息编辑表单组件。

### 完整源代码

```vue
<template>
  <div class="settings-form">
    <!-- 个人信息 -->
    <el-card class="settings-card">
      <template #header>
        <h2>个人信息</h2>
      </template>
      
      <el-form
        :model="profile"
        :rules="profileRules"
        ref="profileFormRef"
        label-width="120px"
      >
        <el-row :gutter="24">
          <el-col :span="12">
            <el-form-item label="姓名" prop="name">
              <el-input
                v-model="profile.name"
                placeholder="请输入姓名"
              />
            </el-form-item>
          </el-col>
          <el-col :span="12">
            <el-form-item label="邮箱" prop="email">
              <el-input
                v-model="profile.email"
                type="email"
                placeholder="请输入邮箱"
              />
            </el-form-item>
          </el-col>
        </el-row>

        <el-row :gutter="24">
          <el-col :span="12">
            <el-form-item label="职位" prop="position">
              <el-input
                v-model="profile.position"
                placeholder="请输入职位"
              />
            </el-form-item>
          </el-col>
          <el-col :span="12">
            <el-form-item label="工作经验" prop="experience">
              <el-select
                v-model="profile.experience"
                placeholder="请选择工作经验"
                style="width: 100%"
              >
                <el-option label="0-1年" value="0-1" />
                <el-option label="1-3年" value="1-3" />
                <el-option label="3-5年" value="3-5" />
                <el-option label="5年以上" value="5+" />
              </el-select>
            </el-form-item>
          </el-col>
        </el-row>
      </el-form>
    </el-card>

    <!-- 保存按钮 -->
    <div class="form-actions">
      <el-button @click="resetForm">重置</el-button>
      <el-button type="primary" @click="saveProfile" :loading="saving">
        保存设置
      </el-button>
    </div>
  </div>
</template>

<script setup>
import { ref, reactive } from 'vue'
import { ElMessage, ElMessageBox } from 'element-plus'
import { userAPI } from '@/api/user'
import { useAuthStore } from '@/composables/useAuth'

// 状态管理
const authStore = useAuthStore()
const profileFormRef = ref()
const saving = ref(false)

// 表单数据
const profile = reactive({
  name: '',
  email: '',
  position: '',
  experience: ''
})

// 表单验证规则
const profileRules = {
  name: [
    { required: true, message: '请输入姓名', trigger: 'blur' },
    { min: 2, max: 20, message: '姓名长度在2到20个字符', trigger: 'blur' }
  ],
  email: [
    { required: true, message: '请输入邮箱', trigger: 'blur' },
    { type: 'email', message: '请输入正确的邮箱格式', trigger: 'blur' }
  ],
  position: [
    { required: false, message: '请输入职位', trigger: 'blur' }
  ],
  experience: [
    { required: false, message: '请选择工作经验', trigger: 'change' }
  ]
}

// 初始化用户信息
const initProfile = () => {
  const user = authStore.user
  if (user) {
    profile.name = user.name || user.username || ''
    profile.email = user.email || ''
    profile.position = user.position || ''
    profile.experience = user.experience || ''
  }
}

// 保存设置
const saveProfile = async () => {
  try {
    const valid = await profileFormRef.value.validate()
    if (!valid) return

    saving.value = true
    const userId = authStore.getUserId()
    
    if (!userId) {
      ElMessage.error('用户未登录')
      return
    }

    // 调用API更新用户信息
    await userAPI.updateUserInfo(userId, {
      name: profile.name,
      email: profile.email,
      position: profile.position,
      experience: profile.experience
    })

    // 刷新用户信息
    await authStore.refreshUserInfo()

    ElMessage.success('设置保存成功')
  } catch (error) {
    console.error('Save profile error:', error)
    ElMessage.error('保存失败: ' + (error.message || '未知错误'))
  } finally {
    saving.value = false
  }
}

// 重置表单
const resetForm = () => {
  ElMessageBox.confirm('确定要重置所有设置吗？', '提示', {
    confirmButtonText: '确定',
    cancelButtonText: '取消',
    type: 'warning'
  }).then(() => {
    initProfile()
    ElMessage.success('已重置')
  }).catch(() => {
    // 用户取消
  })
}

// 组件挂载时初始化
import { onMounted } from 'vue'
onMounted(() => {
  initProfile()
})
</script>

<style scoped>
.settings-form {
  padding: var(--spacing-lg);
}

.settings-card {
  margin-bottom: var(--spacing-lg);
}

.form-actions {
  display: flex;
  justify-content: flex-end;
  gap: var(--spacing-md);
  margin-top: var(--spacing-lg);
}
</style>
```

## 4. SimpleProfileDisplay.vue - 简化版个人资料展示组件

一个简化版的个人资料展示组件，适用于简单的用户信息展示场景。

### 完整源代码

```vue
<template>
  <el-card class="simple-profile-card">
    <template #header>
      <div class="profile-header">
        <el-avatar :size="64" :src="userData.avatar">
          {{ userData.name?.[0] || 'U' }}
        </el-avatar>
        <div class="profile-info">
          <h3>{{ userData.name || userData.username || '未设置' }}</h3>
          <p class="profile-email">{{ userData.email || '未设置邮箱' }}</p>
        </div>
      </div>
    </template>

    <el-descriptions :column="2" border>
      <el-descriptions-item label="职位">
        {{ userData.position || '未设置' }}
      </el-descriptions-item>
      <el-descriptions-item label="工作经验">
        {{ formatExperience(userData.experience) }}
      </el-descriptions-item>
      <el-descriptions-item label="注册时间">
        {{ formatDate(userData.created_at) }}
      </el-descriptions-item>
      <el-descriptions-item label="最后登录">
        {{ formatDate(userData.last_login_at) }}
      </el-descriptions-item>
    </el-descriptions>
  </el-card>
</template>

<script setup>
import { computed } from 'vue'
import { useAuthStore } from '@/composables/useAuth'

// Props定义
const props = defineProps({
  userData: {
    type: Object,
    default: () => ({})
  },
  // 如果未传入userData，则使用authStore中的用户信息
  useAuthStore: {
    type: Boolean,
    default: true
  }
})

// 状态管理
const authStore = useAuthStore()

// 计算属性：获取用户数据
const userData = computed(() => {
  if (props.useAuthStore && !props.userData) {
    return authStore.user
  }
  return props.userData || {}
})

// 格式化工作经验
const formatExperience = (exp) => {
  const expMap = {
    '0-1': '0-1年',
    '1-3': '1-3年',
    '3-5': '3-5年',
    '5+': '5年以上'
  }
  return expMap[exp] || exp || '未设置'
}

// 格式化日期
const formatDate = (dateStr) => {
  if (!dateStr) return '未知'
  const date = new Date(dateStr)
  return date.toLocaleDateString('zh-CN', {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit'
  })
}
</script>

<style scoped>
.simple-profile-card {
  margin-bottom: var(--spacing-lg);
}

.profile-header {
  display: flex;
  align-items: center;
  gap: var(--spacing-lg);
}

.profile-info h3 {
  margin: 0 0 var(--spacing-xs) 0;
  font-size: var(--font-size-xl);
  font-weight: 600;
  color: var(--text-color-primary);
}

.profile-email {
  margin: 0;
  color: var(--text-color-secondary);
  font-size: var(--font-size-sm);
}
</style>
```

### 使用示例

```vue
<template>
  <!-- 使用authStore中的用户信息 -->
  <SimpleProfileDisplay />

  <!-- 或传入自定义用户数据 -->
  <SimpleProfileDisplay 
    :user-data="customUserData"
    :use-auth-store="false"
  />
</template>

<script setup>
import SimpleProfileDisplay from '@/components/SimpleProfileDisplay.vue'

const customUserData = {
  name: '李四',
  email: 'lisi@example.com',
  position: '前端工程师',
  experience: '3-5'
}
</script>
```

---

**继续阅读**: 下一部分包含API接口和状态管理代码。

