# 导航统一布局实施计划

## 背景与目标
- **背景**：当前 `AppHeader` 与多个页面之间存在重复实现且缺乏统一配置，难以在不同用户角色间维持一致体验。
- **目标**：落地“方案一：Nav 配置驱动 + Layout 注入”，实现导航配置集中化、布局解耦，并为后续功能扩展（公告、快捷入口等）打好基础。
- **更新时间**：2025-11-24 10:15

## 目录
1. 现状与问题
2. 方案概述
3. 实施步骤
4. 任务拆解（ToDoList）
5. 风险与缓解
6. 验收标准

## 1. 现状与问题
- `AppHeader` 内部写死导航内容，仅依据登录态切换，无法区分角色场景。
- `Home`、`MyProject`、`Profile` 等页面内仍嵌入旧样式 Header，造成维护成本高。
- 各 Layout 未向 Header 传递上下文信息，后续若要扩展角色定制需在 Header 内写条件，耦合度高。

## 2. 方案概述（方案一）
- 新增 `src/utils/navConfig.js`，以角色为 key 管理顶部导航、下拉分组、快捷入口、样式风格。
- `DefaultLayout`、`AdminLayout` 读取 `useAuthStore` 和路由上下文，计算当前角色对应的导航配置，通过 Props 注入 `AppHeader`。
- `AppHeader` 精简为纯渲染组件，负责渲染品牌区、导航项、登录/用户状态展示，交互事件透出给上层。
- `UserPanel` 接收扩展属性以显示不同角色的快捷菜单。

## 3. 实施步骤（详细版）

### 一、准备与基线检查
- **目标确认**：所有页面统一使用 Layout+AppHeader，导航由配置驱动，角色差异正确，复用 home 页样式。
- **清单收集**：列出当前仍手写 header 的页面（Home、ProjectHall、学生、企业、教师、管理员等），记录文件路径与路由。
  - 已确认：`src/views/home/index.vue`、`src/views/user/Profile/index.vue`、`src/views/student/MyProject/index.vue`
- **样式基线**：以 `/home` 的导航样式为最终标准，截图留存对比。
- **Store 依赖确认**：
  - `authStore` 提供字段：`role`（getter，取值：`student`/`enterprise`/`teacher`/`admin`/空字符串）、`isLoggedIn`、`userInfo`（含 `username`、`avatar`）
  - **未读数处理**：当前 `AppHeader` 中 `unreadCount` 为硬编码 `ref(2)`，需改为从 store 或 API 获取，若接口未通提供 mock `unreadCount = 0` 避免报错。

### 二、导航配置设计与落地
- **新建文件**：`src/utils/navConfig.js`，导出：
  - 角色枚举：`visitor`、`student`、`enterprise`、`teacher`、`admin`。
  - 菜单结构类型：`{ label, path, type?, children?, requireLogin?, badgeKey?, matchRoute? }`。
    - `type`: `'link'`（普通链接）或 `'dropdown'`（下拉菜单）
    - `children`: 仅当 `type === 'dropdown'` 时使用，数组格式同菜单项
    - `requireLogin`: 布尔值，未登录时点击跳转登录页
    - `badgeKey`: 字符串，用于映射 `unreadCount[badgeKey]`（如 `'messages'`）
    - `matchRoute`: 函数或正则，用于高亮匹配（如 `/projects/:id` 仍高亮项目大厅）
  - 获取函数：`getNavByRole(role, isLoggedIn)`，返回 `{ navItems, quickActions, variant }`。
    - `navItems`: 导航项数组
    - `quickActions`: UserPanel 快捷操作数组 `[{ label, path, type: 'normal'|'danger' }]`
    - `variant`: 样式变体，如 `'default'`、`'transparent'`（首页透明背景）
- **内容来源**：参照现有路由表（`src/router/modules/*`），保证与实际路由匹配（校对成长中心路径、消息中心路径、项目子路由等）。
- **示例数据骨架**（需按实际路由替换）：
  - **访客**：首页 `/home`、项目大厅 `/projects`、成长中心（提示登录跳转 `/login?redirect=/growth-center`）、消息（同理）、登录 `/login`、注册 `/register`。
  - **学生**：创客空间下拉（项目大厅 `/projects`、热门项目 `/projects?sort=hot`、项目详情占位）、我的项目下拉（`/my-projects`、`/tracker/:projectId`、`/submit/:projectId`）、成长中心下拉（`/growth-center` 及子 tab）、消息（`badgeKey: 'messages'` 关联未读数）、用户面板快捷操作。
  - **企业/教师/管理员**：参照现有路由表，按角色需求配置。
- **配置注意**：
  - `badgeKey` 预留与 `authStore` 未读字段映射（当前可先 mock，后续接入 API）。
  - `matchRoute` 用于高亮需要匹配多路径的项（如 `/projects/:id` 仍高亮项目大厅，可用函数 `(route) => route.path.startsWith('/projects')`）。
  - 需要登录的项设置 `requireLogin: true`，供未登录状态的处理（跳登录或禁用）。

### 三、AppHeader 重构（配置驱动）
- **Props 定义**：
  ```javascript
  {
    navItems: Array,        // 导航项数组
    quickActions: Array,    // UserPanel 快捷操作
    variant: String,        // 样式变体：'default' | 'transparent'
    unreadCount: Object,   // { messages: 2, ... } 或 {}
    showAuthArea: Boolean,  // 是否显示登录/用户区域
    onLogin: Function,      // 登录按钮点击回调
    onLogout: Function      // 退出登录回调
  }
  ```
- **渲染逻辑**：
  - 顶层遍历 `navItems`，`type === 'dropdown'` 使用 `el-dropdown` 渲染子项；普通链接用 `<router-link>`。
  - `badgeKey` 对应的项显示 `unreadCount[badgeKey]`（无则 0）。
  - 未登录且 `requireLogin` 的项点击时触发 `emit('needLogin', { path, label })` 或直接跳转 `/login?redirect=${encodeURIComponent(path)}`。
  - 保留 Logo、登录/注册按钮、头像+UserPanel 下拉。
  - 高亮逻辑：使用 `router.currentRoute.value.path` 与 `navItem.path` 或 `matchRoute` 匹配。
- **样式**：
  - 复用 home 导航样式：高度、背景、hover、active 状态；`variant` 为 `'transparent'` 时背景透明、滚动后加阴影。
  - 所有注释使用中文，保持 2 空格缩进、scoped 或 BEM 命名。

### 四、UserPanel 扩展
- **Props**：`quickActions`（数组：`{ label, path, type: 'normal'|'danger' }`），`onLogout`。
- **渲染**：动作区按 `type` 区分（如 `danger` 用于退出，样式红色）。
- **交互**：点击快捷项 `router.push(path)`；退出调用 `emit('logout')`。

### 五、Layout 注入
- **DefaultLayout/AdminLayout 内**：
  - 引入 `useAuthStore`，获取 `role`、`isLoggedIn`、`unreadCount`（当前可 mock，后续从 store 或 API 获取）。
  - 计算 `navConfig = getNavByRole(role || 'visitor', isLoggedIn)`。
  - 向 `AppHeader` 传递 `navItems`、`quickActions`、`variant`、`unreadCount`、登录/退出回调。
  - 预留 slot 或 prop 控制首页特殊 variant（如透明背景）。
  - **角色缺失兜底**：在 `authStore` 增加默认 `role = 'visitor'`；未加载完成时 Layout 可显示 loading 状态，暂不渲染导航。
- **路由包装**：
  - 在 `router/modules/*` 中确保页面用对应 Layout 包裹；登录/注册等可用空布局。
  - 移除各页面内部自定义 header 代码。

### 六、页面清理与回归
- **按清单逐页移除旧 Header**，确认使用 Layout 后的导航显示正常。
  - `src/views/home/index.vue`：移除 `<header class="main-header">` 及其内部导航代码（保留页面内容）。
  - `src/views/user/Profile/index.vue`：移除自定义 header。
  - `src/views/student/MyProject/index.vue`：移除自定义 header。
  - 检查其他页面（如 `ProjectHall`）是否也有自定义 header。
- **校验高亮**：访问 `/projects/:id` 时项目大厅高亮；`/growth-center?tab=ranking` 仍高亮成长中心。
- **样式回归**：对比 home 样式，若有差异，补充公用样式变量（header 高度、主色、hover 色）。

### 七、数据与交互兜底
- **角色缺失**：在 `authStore` 增加默认 `role = 'visitor'`；未加载完成时 Layout 可显示 loading 状态，暂不渲染导航。
- **未读数**：若接口未通，提供 mock `unreadCount = {}`，避免报错。
- **登录重定向**：`needLogin` 行为统一跳 `/login?redirect=${currentRoute.fullPath}`。

## 4. 任务拆解（ToDoList）
1. **配置文件创建**：完成 `navConfig.js`，覆盖所有角色的菜单、下拉、快捷操作。
2. **Layout 修改**：`DefaultLayout`、`AdminLayout` 读取 store，并将导航配置及统计数据以 Props 注入。
3. **AppHeader 重构**：重写 Props、模板与交互，支持配置驱动，保留原有功能。
4. **UserPanel 优化**：支持渲染多快捷操作，区分危险/普通操作样式。
5. **页面清理**：删除各页面内的自定义 Header，改为依赖统一布局。
6. **验证与样式统一**：全局检查，在 `[000]功能模块文档.md` 中同步更新头部模块描述。

## 5. 风险与缓解
- **菜单缺项风险**：配置初期可能遗漏路由 → 列出所有角色需求清单并评审。
- **角色信息延迟**：若 `authStore` 异步加载导致导航闪烁 → 在布局中增加 loading 兜底。
- **老页面依赖旧样式**：清理时注意 CSS 作用域，必要时抽离公共样式。

## 6. 验收标准
- 各角色登录后顶部导航与快捷操作均符合配置文件描述，访客状态显示登录/注册按钮。
- 所有页面统一使用 `AppHeader`，无重复自定义 Header 片段。
- `[000]功能模块文档.md` 补充“导航统一配置”描述并记录实施时间。
- 通过基本路由跳转与登录切换手工验证，无明显样式错位或控制台错误。

