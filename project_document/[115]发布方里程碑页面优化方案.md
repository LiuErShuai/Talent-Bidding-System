# 发布方里程碑页面优化方案

- **背景**：当前企业端里程碑页面与学生端基本一致，缺少发布方专属的审核、反馈、操作功能，不符合发布方角色定位。
- **目标**：根据 `[114]发布方里程碑交互设计.md` 的设计要求，优化企业端里程碑页面，实现发布方与承接方的角色差异化展示与操作。
- **时间戳**：2025-11-27 16:00

---

## 目录

1. [现状分析](#1-现状分析)
2. [优化目标](#2-优化目标)
3. [详细优化方案](#3-详细优化方案)
   - 3.1 [角色判断与权限控制](#31-角色判断与权限控制)
   - 3.2 [里程碑卡片结构优化](#32-里程碑卡片结构优化)
   - 3.3 [发布方操作区设计](#33-发布方操作区设计)
   - 3.4 [承接方提交摘要区域](#34-承接方提交摘要区域)
   - 3.5 [审核历史记录展示](#35-审核历史记录展示)
   - 3.6 [审核弹窗设计](#36-审核弹窗设计)
   - 3.7 [跳过里程碑功能](#37-跳过里程碑功能)
4. [各里程碑具体优化点](#4-各里程碑具体优化点)
5. [数据结构扩展](#5-数据结构扩展)
6. [API接口需求](#6-api接口需求)
7. [实施计划](#7-实施计划)

---

## 1. 现状分析

### 1.1 当前问题

1. **角色区分不足**：
   - 发布方和承接方使用相同的UI和操作按钮
   - 操作按钮显示"更新进度"、"提交XX"，这些是承接方的操作，不适合发布方
   - 缺少发布方专属的审核、通过、驳回等操作

2. **信息展示不匹配**：
   - 缺少"承接方提交摘要"区域，发布方无法快速了解承接方提交内容
   - 缺少审核历史记录展示，无法追溯审核过程
   - 缺少待办数量、风险预警等发布方关注的信息

3. **功能缺失**：
   - 缺少审核功能（通过/驳回/要求修改）
   - 缺少跳过里程碑功能（中期答辩）
   - 缺少审核历史记录
   - 缺少二次确认机制（关键操作）

4. **状态显示不完整**：
   - 缺少 `skipped`（已跳过）状态的显示
   - 状态标签文本未区分发布方视角

### 1.2 现有代码位置

- **文件路径**：`src/views/project/Detail/index.vue`
- **关键代码行**：
  - 330-455行：里程碑标签页内容
  - 427-447行：操作按钮区域（需优化）
  - 753-775行：权限判断逻辑（需扩展）
  - 462-520行：里程碑操作弹窗（需区分角色）

---

## 2. 优化目标

### 2.1 核心目标

1. **角色差异化**：发布方聚焦审核/反馈/记录，承接方聚焦提交/更新
2. **就地操作**：所有审核动作在里程碑卡片内完成，减少跳转
3. **信息透明**：发布方可快速了解承接方提交内容、审核历史、风险提示
4. **操作便捷**：提供清晰的审核入口、快捷操作按钮、二次确认机制

### 2.2 优化范围

- 里程碑卡片结构重构
- 发布方操作区新增
- 审核弹窗设计
- 审核历史记录展示
- 跳过里程碑功能
- 状态流转优化

---

## 3. 详细优化方案

### 3.1 角色判断与权限控制

#### 3.1.1 新增计算属性

```javascript
// 判断是否是发布方
const isPublisher = computed(() => {
  if (!currentUser.value.isLoggedIn) return false
  return currentUser.value.role === 'enterprise' && 
         currentUser.value.id === project.value.publisherId
})

// 判断是否是承接方
const isBidder = computed(() => {
  if (!currentUser.value.isLoggedIn) return false
  return currentUser.value.role === 'student' && 
         project.value.bidderIds?.includes(currentUser.value.id)
})

// 判断当前里程碑是否需要发布方审核
const needsPublisherReview = (milestone) => {
  return milestone.status === 'in-progress' && 
         ['BIDDING', 'PROPOSAL_SUBMIT', 'MIDTERM_DEFENSE', 'FINAL_DELIVERY', 'FINAL_REVIEW', 'PAYMENT', 'ANNOUNCEMENT'].includes(milestone.code)
}

// 判断里程碑是否可跳过
const canSkipMilestone = (milestone) => {
  return milestone.code === 'MIDTERM_DEFENSE' && 
         milestone.status !== 'completed' && 
         milestone.status !== 'skipped'
}
```

#### 3.1.2 权限控制规则

| 功能 | 发布方 | 承接方 | 访客 |
|------|--------|--------|------|
| 查看里程碑列表 | ✅ | ✅ | ✅ |
| 查看里程碑详情 | ✅ | ✅ | ✅ |
| 查看承接方提交摘要 | ✅ | ❌ | ❌ |
| 审核操作（通过/驳回） | ✅ | ❌ | ❌ |
| 查看审核历史 | ✅ | ✅（只读） | ❌ |
| 跳过里程碑 | ✅（仅中期答辩） | ❌ | ❌ |
| 提交/更新进度 | ❌ | ✅ | ❌ |

---

### 3.2 里程碑卡片结构优化

#### 3.2.1 新卡片结构

```
里程碑卡片
├── 顶部区域
│   ├── 里程碑标题
│   ├── 状态标签（支持 skipped 状态）
│   └── 操作按钮组（根据角色显示）
├── 承接方提交摘要区域（仅发布方可见，承接方提交后显示）
│   ├── 提交内容概览
│   ├── 提交时间
│   └── 快速查看按钮
├── 发布方操作区（仅发布方可见，状态为 in-progress 时显示）
│   ├── 审核按钮（通过/驳回/要求修改）
│   ├── 跳过按钮（仅可跳过里程碑）
│   └── 查看详情按钮
├── 审核历史记录（折叠面板，仅项目参与者可见）
│   ├── 审核记录列表
│   ├── 审核人、时间、结果
│   └── 审核意见、附件
└── 基础信息（所有用户可见）
    ├── 计划时间
    ├── 实际完成时间
    └── 交付物列表
```

#### 3.2.2 卡片布局代码结构

```vue
<div class="milestone-card">
  <!-- 顶部区域 -->
  <div class="milestone-header">
    <div class="milestone-title-row">
      <h3 class="milestone-title">{{ milestone.title }}</h3>
      <div class="milestone-header-actions">
        <el-tag :type="getMilestoneTagType(milestone.status)" size="small">
          {{ getMilestoneStatusText(milestone.status) }}
        </el-tag>
        <!-- 发布方专属：待办数量提示 -->
        <el-badge 
          v-if="isPublisher && needsPublisherReview(milestone)" 
          :value="1" 
          class="review-badge"
        >
          <el-icon><Bell /></el-icon>
        </el-badge>
      </div>
    </div>
  </div>

  <!-- 承接方提交摘要区域（仅发布方可见） -->
  <div v-if="isPublisher && milestone.submissionSummary" class="submission-summary-section">
    <div class="section-header">
      <el-icon><Document /></el-icon>
      <span>承接方提交摘要</span>
    </div>
    <div class="submission-content">
      <!-- 根据里程碑类型显示不同内容 -->
      <div v-if="milestone.code === 'BIDDING'" class="bidding-summary">
        <p>申请者：{{ milestone.submissionSummary.applicantName }}</p>
        <p>申请理由：{{ milestone.submissionSummary.reason }}</p>
        <p>提交时间：{{ milestone.submissionSummary.submitTime }}</p>
      </div>
      <div v-else-if="milestone.code === 'PROPOSAL_SUBMIT'" class="proposal-summary">
        <p>方案标题：{{ milestone.submissionSummary.title }}</p>
        <p>技术栈：{{ milestone.submissionSummary.techStack?.join(', ') }}</p>
        <p>提交时间：{{ milestone.submissionSummary.submitTime }}</p>
      </div>
      <!-- 其他里程碑类型的摘要... -->
    </div>
    <el-button type="text" size="small" @click="viewSubmissionDetail(milestone)">
      查看完整内容 <el-icon><ArrowRight /></el-icon>
    </el-button>
  </div>

  <!-- 发布方操作区（仅发布方可见，状态为 in-progress 时显示） -->
  <div v-if="isPublisher && needsPublisherReview(milestone)" class="publisher-actions-section">
    <div class="actions-header">
      <el-icon><EditPen /></el-icon>
      <span>发布方操作</span>
    </div>
    <div class="actions-buttons">
      <!-- 根据里程碑类型显示不同操作按钮 -->
      <el-button 
        v-if="milestone.code === 'BIDDING'"
        type="success" 
        @click="openReviewDialog(milestone, '通过')"
      >
        <el-icon><Check /></el-icon>
        通过申请
      </el-button>
      <el-button 
        v-if="milestone.code === 'BIDDING'"
        type="danger" 
        @click="openReviewDialog(milestone, '拒绝')"
      >
        <el-icon><Close /></el-icon>
        拒绝申请
      </el-button>
      <el-button 
        v-else
        type="primary" 
        @click="openReviewDialog(milestone, '审核')"
      >
        <el-icon><EditPen /></el-icon>
        {{ getReviewButtonText(milestone) }}
      </el-button>
      <!-- 跳过按钮（仅中期答辩） -->
      <el-button 
        v-if="canSkipMilestone(milestone)"
        type="warning" 
        @click="openSkipDialog(milestone)"
      >
        <el-icon><Remove /></el-icon>
        跳过此里程碑
      </el-button>
    </div>
  </div>

  <!-- 承接方操作区（仅承接方可见） -->
  <div v-if="isBidder && canOperateMilestone(milestone)" class="bidder-actions-section">
    <!-- 保持原有逻辑 -->
  </div>

  <!-- 审核历史记录（折叠面板） -->
  <el-collapse v-if="isProjectParticipant && milestone.reviewHistory?.length > 0" class="review-history-collapse">
    <el-collapse-item name="review-history">
      <template #title>
        <div class="collapse-title">
          <el-icon><Clock /></el-icon>
          <span>审核历史（{{ milestone.reviewHistory.length }}条）</span>
        </div>
      </template>
      <div class="review-history-list">
        <div 
          v-for="(review, idx) in milestone.reviewHistory" 
          :key="review.reviewId"
          class="review-history-item"
        >
          <div class="review-header">
            <span class="reviewer">{{ review.reviewerName }}</span>
            <span class="review-time">{{ review.reviewTime }}</span>
            <el-tag :type="getReviewResultTagType(review.reviewResult)" size="small">
              {{ review.reviewResult }}
            </el-tag>
          </div>
          <div class="review-content">
            <p>{{ review.reviewComment }}</p>
            <div v-if="review.attachments?.length > 0" class="review-attachments">
              <el-icon><Paperclip /></el-icon>
              <span v-for="(att, i) in review.attachments" :key="i" class="attachment-link">
                {{ att.name }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </el-collapse-item>
  </el-collapse>

  <!-- 基础信息（所有用户可见） -->
  <div class="milestone-meta">
    <!-- 保持原有逻辑 -->
  </div>
</div>
```

---

### 3.3 发布方操作区设计

#### 3.3.1 操作按钮规则

| 里程碑代码 | 操作按钮 | 按钮类型 | 说明 |
|-----------|---------|---------|------|
| BIDDING | 通过申请 | success | 确认承接方 |
| BIDDING | 拒绝申请 | danger | 拒绝申请（需填写原因） |
| PROPOSAL_SUBMIT | 审核方案 | primary | 打开审核弹窗 |
| MIDTERM_DEFENSE | 进入中期答辩 | primary | 跳转评审页或全屏弹窗 |
| MIDTERM_DEFENSE | 跳过此里程碑 | warning | 跳过（需填写原因，二次确认） |
| FINAL_DELIVERY | 审核成果 | primary | 打开审核弹窗 |
| FINAL_REVIEW | 开始评审 | primary | 打开评审弹窗 |
| PAYMENT | 确认支付金额 | primary | 打开金额确认弹窗 |
| PAYMENT | 发起支付 | success | 发起支付（二次确认） |
| PAYMENT | 确认到账 | success | 确认到账 |
| PAYMENT | 上传发票 | default | 上传发票 |
| ANNOUNCEMENT | 上传公示内容 | primary | 上传公示内容 |
| ANNOUNCEMENT | 设置公示期 | primary | 设置公示期 |
| ANNOUNCEMENT | 开始公示 | success | 开始公示（二次确认） |

#### 3.3.2 操作区样式设计

```css
.publisher-actions-section {
  margin-top: 16px;
  padding: 16px;
  background: #f5f7fa;
  border-radius: 8px;
  border-left: 4px solid #409eff;
}

.actions-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 12px;
  font-weight: 600;
  color: #303133;
}

.actions-buttons {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}
```

---

### 3.4 承接方提交摘要区域

#### 3.4.1 摘要内容设计

根据里程碑类型显示不同的摘要信息：

**揭榜征集（BIDDING）**：
- 申请者信息（姓名、学号、专业）
- 申请理由（摘要）
- 团队信息（如团队揭榜）
- 提交时间

**方案提交（PROPOSAL_SUBMIT）**：
- 方案标题
- 技术栈（标签形式）
- 实施计划概述
- 附件数量
- 提交时间

**中期答辩（MIDTERM_DEFENSE）**：
- 答辩材料类型（PPT/视频/文档）
- 进度对比摘要
- 问题清单数量
- 提交时间

**成果提交（FINAL_DELIVERY）**：
- 成果标题
- 交付物类型（代码/文档/测试报告等）
- 部署地址（如有）
- 提交时间

**其他里程碑**：根据实际提交内容显示摘要

#### 3.4.2 摘要区域代码

```vue
<div v-if="isPublisher && milestone.submissionSummary" class="submission-summary-section">
  <div class="section-header">
    <el-icon><Document /></el-icon>
    <span>承接方提交摘要</span>
    <el-tag v-if="milestone.submissionSummary.version" size="small" type="info">
      版本 v{{ milestone.submissionSummary.version }}
    </el-tag>
  </div>
  <div class="submission-content">
    <!-- 动态渲染摘要内容 -->
    <component 
      :is="getSummaryComponent(milestone.code)" 
      :summary="milestone.submissionSummary"
    />
  </div>
  <div class="submission-actions">
    <el-button type="text" size="small" @click="viewSubmissionDetail(milestone)">
      查看完整内容 <el-icon><ArrowRight /></el-icon>
    </el-button>
    <el-button 
      v-if="milestone.submissionSummary.hasHistory" 
      type="text" 
      size="small"
      @click="viewSubmissionHistory(milestone)"
    >
      查看历史版本 <el-icon><Clock /></el-icon>
    </el-button>
  </div>
</div>
```

---

### 3.5 审核历史记录展示

#### 3.5.1 审核历史列表设计

```vue
<el-collapse v-if="isProjectParticipant && milestone.reviewHistory?.length > 0">
  <el-collapse-item name="review-history">
    <template #title>
      <div class="collapse-title">
        <el-icon><Clock /></el-icon>
        <span>审核历史（{{ milestone.reviewHistory.length }}条）</span>
        <el-badge 
          v-if="milestone.reviewHistory.length > 0" 
          :value="milestone.reviewHistory.length" 
          class="badge"
        />
      </div>
    </template>
    <div class="review-history-list">
      <div 
        v-for="(review, idx) in milestone.reviewHistory" 
        :key="review.reviewId"
        class="review-history-item"
        :class="{ 'latest-review': idx === 0 }"
      >
        <!-- 审核记录头部 -->
        <div class="review-header">
          <div class="reviewer-info">
            <el-avatar :size="32" :src="review.reviewerAvatar">
              {{ review.reviewerName?.charAt(0) }}
            </el-avatar>
            <div class="reviewer-details">
              <span class="reviewer-name">{{ review.reviewerName }}</span>
              <span class="review-time">{{ formatTime(review.reviewTime) }}</span>
            </div>
          </div>
          <div class="review-result">
            <el-tag :type="getReviewResultTagType(review.reviewResult)" size="small">
              {{ review.reviewResult }}
            </el-tag>
            <span v-if="review.submissionVersion" class="version-tag">
              版本 v{{ review.submissionVersion }}
            </span>
          </div>
        </div>
        
        <!-- 审核内容 -->
        <div class="review-content">
          <p class="review-comment">{{ review.reviewComment }}</p>
          
          <!-- 附件列表 -->
          <div v-if="review.attachments?.length > 0" class="review-attachments">
            <el-icon><Paperclip /></el-icon>
            <span 
              v-for="(att, i) in review.attachments" 
              :key="i" 
              class="attachment-link"
              @click="downloadAttachment(att)"
            >
              {{ att.name }}
            </span>
          </div>
          
          <!-- 扩展字段（根据里程碑类型） -->
          <div v-if="review.highlights" class="review-extended">
            <div class="extended-item">
              <span class="label">亮点：</span>
              <span>{{ review.highlights }}</span>
            </div>
          </div>
          <div v-if="review.issues" class="review-extended">
            <div class="extended-item">
              <span class="label">问题：</span>
              <span>{{ review.issues }}</span>
            </div>
          </div>
          <div v-if="review.rectificationRequirements" class="review-extended">
            <div class="extended-item">
              <span class="label">整改要求：</span>
              <span>{{ review.rectificationRequirements }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </el-collapse-item>
</el-collapse>
```

#### 3.5.2 审核历史样式

```css
.review-history-list {
  max-height: 400px;
  overflow-y: auto;
}

.review-history-item {
  padding: 16px;
  border-bottom: 1px solid #ebeef5;
  transition: background-color 0.3s;
}

.review-history-item:hover {
  background-color: #f5f7fa;
}

.review-history-item.latest-review {
  background-color: #ecf5ff;
  border-left: 3px solid #409eff;
}

.review-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.reviewer-info {
  display: flex;
  align-items: center;
  gap: 12px;
}

.review-content {
  margin-left: 44px;
}

.review-comment {
  margin: 0 0 8px 0;
  color: #606266;
  line-height: 1.6;
}

.review-attachments {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-top: 8px;
  color: #909399;
  font-size: 14px;
}

.attachment-link {
  color: #409eff;
  cursor: pointer;
  text-decoration: underline;
}

.attachment-link:hover {
  color: #66b1ff;
}
```

---

### 3.6 审核弹窗设计

#### 3.6.1 审核弹窗结构

```vue
<el-dialog
  v-model="reviewDialogVisible"
  :title="getReviewDialogTitle(currentReviewMilestone)"
  width="900px"
  :close-on-click-modal="false"
  destroy-on-close
>
  <div class="review-dialog-content">
    <!-- 左侧：承接方提交内容（只读） -->
    <div class="review-left-panel">
      <div class="panel-header">
        <el-icon><Document /></el-icon>
        <span>承接方提交内容</span>
      </div>
      <div class="submission-preview">
        <!-- 根据里程碑类型显示不同内容 -->
        <component 
          :is="getSubmissionPreviewComponent(currentReviewMilestone.code)" 
          :submission="currentReviewMilestone.submissionDetail"
        />
      </div>
    </div>
    
    <!-- 右侧：审核表单 -->
    <div class="review-right-panel">
      <el-form 
        ref="reviewFormRef"
        :model="reviewForm" 
        :rules="reviewRules" 
        label-width="100px"
      >
        <!-- 审核结果 -->
        <el-form-item label="审核结果" prop="reviewResult">
          <el-radio-group v-model="reviewForm.reviewResult">
            <el-radio 
              v-for="option in getReviewResultOptions(currentReviewMilestone.code)" 
              :key="option.value"
              :label="option.value"
            >
              {{ option.label }}
            </el-radio>
          </el-radio-group>
        </el-form-item>
        
        <!-- 审核意见（必填） -->
        <el-form-item label="审核意见" prop="reviewComment">
          <el-input
            v-model="reviewForm.reviewComment"
            type="textarea"
            :rows="6"
            placeholder="请填写审核意见..."
            show-word-limit
            maxlength="1000"
          />
        </el-form-item>
        
        <!-- 附件上传 -->
        <el-form-item label="附件">
          <el-upload
            v-model:file-list="reviewForm.attachments"
            action="#"
            multiple
            :auto-upload="false"
            :limit="5"
          >
            <el-button type="primary">
              <el-icon><Upload /></el-icon>
              上传附件
            </el-button>
            <template #tip>
              <div class="el-upload__tip">
                支持上传评审意见文档、修改建议清单等，最多5个文件
              </div>
            </template>
          </el-upload>
        </el-form-item>
        
        <!-- 扩展字段（根据里程碑类型） -->
        <!-- 中期答辩：亮点、问题、整改要求 -->
        <template v-if="currentReviewMilestone.code === 'MIDTERM_DEFENSE'">
          <el-form-item label="亮点总结">
            <el-input
              v-model="reviewForm.highlights"
              type="textarea"
              :rows="3"
              placeholder="可选：总结项目亮点..."
            />
          </el-form-item>
          <el-form-item label="问题清单">
            <el-input
              v-model="reviewForm.issues"
              type="textarea"
              :rows="3"
              placeholder="可选：列出发现的问题..."
            />
          </el-form-item>
          <el-form-item 
            v-if="reviewForm.reviewResult === '不通过'"
            label="整改要求"
            prop="rectificationRequirements"
          >
            <el-input
              v-model="reviewForm.rectificationRequirements"
              type="textarea"
              :rows="4"
              placeholder="请填写整改要求..."
            />
          </el-form-item>
        </template>
        
        <!-- 成果提交：分步骤验收 -->
        <template v-if="currentReviewMilestone.code === 'FINAL_DELIVERY'">
          <el-form-item label="功能验收">
            <el-radio-group v-model="reviewForm.stepReviews.function">
              <el-radio label="通过">通过</el-radio>
              <el-radio label="需修订">需修订</el-radio>
            </el-radio-group>
          </el-form-item>
          <el-form-item label="文档验收">
            <el-radio-group v-model="reviewForm.stepReviews.document">
              <el-radio label="通过">通过</el-radio>
              <el-radio label="需修订">需修订</el-radio>
            </el-radio-group>
          </el-form-item>
          <el-form-item label="部署验收">
            <el-radio-group v-model="reviewForm.stepReviews.deployment">
              <el-radio label="通过">通过</el-radio>
              <el-radio label="需修订">需修订</el-radio>
            </el-radio-group>
          </el-form-item>
        </template>
        
        <!-- 是否提醒承接方 -->
        <el-form-item>
          <el-checkbox v-model="reviewForm.notifyBidder">
            提醒承接方查看审核结果
          </el-checkbox>
        </el-form-item>
      </el-form>
    </div>
  </div>
  
  <template #footer>
    <div class="dialog-footer">
      <el-button @click="reviewDialogVisible = false">取消</el-button>
      <el-button type="primary" @click="submitReview" :loading="reviewSubmitting">
        提交审核
      </el-button>
    </div>
  </template>
</el-dialog>
```

#### 3.6.2 审核弹窗样式

```css
.review-dialog-content {
  display: flex;
  gap: 24px;
  min-height: 500px;
}

.review-left-panel {
  flex: 1;
  border-right: 1px solid #ebeef5;
  padding-right: 24px;
  max-height: 600px;
  overflow-y: auto;
}

.review-right-panel {
  flex: 1;
  padding-left: 24px;
}

.panel-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 16px;
  font-weight: 600;
  color: #303133;
}

.submission-preview {
  background: #f5f7fa;
  padding: 16px;
  border-radius: 8px;
}
```

---

### 3.7 跳过里程碑功能

#### 3.7.1 跳过确认弹窗

```vue
<el-dialog
  v-model="skipDialogVisible"
  title="跳过里程碑"
  width="500px"
  :close-on-click-modal="false"
>
  <el-alert
    type="warning"
    :closable="false"
    show-icon
    style="margin-bottom: 20px"
  >
    <template #title>
      <span>跳过操作不可恢复，请谨慎操作！</span>
    </template>
  </el-alert>
  
  <el-form 
    ref="skipFormRef"
    :model="skipForm" 
    :rules="skipRules" 
    label-width="100px"
  >
    <el-form-item label="里程碑">
      <span>{{ currentSkipMilestone?.title }}</span>
    </el-form-item>
    
    <el-form-item label="跳过原因" prop="skipReason">
      <el-input
        v-model="skipForm.skipReason"
        type="textarea"
        :rows="4"
        placeholder="请填写跳过原因（必填）..."
        show-word-limit
        maxlength="500"
      />
    </el-form-item>
  </el-form>
  
  <template #footer>
    <div class="dialog-footer">
      <el-button @click="skipDialogVisible = false">取消</el-button>
      <el-button type="warning" @click="confirmSkip" :loading="skipSubmitting">
        确认跳过
      </el-button>
    </div>
  </template>
</el-dialog>
```

#### 3.7.2 跳过逻辑

```javascript
const confirmSkip = async () => {
  await skipFormRef.value.validate()
  
  // 二次确认
  await ElMessageBox.confirm(
    `确定跳过"${currentSkipMilestone.value.title}"里程碑吗？跳过后不可恢复！`,
    '二次确认',
    {
      confirmButtonText: '确定跳过',
      cancelButtonText: '取消',
      type: 'warning',
      dangerouslyUseHTMLString: false
    }
  )
  
  try {
    skipSubmitting.value = true
    await skipMilestone(currentSkipMilestone.value.id, skipForm.value.skipReason)
    ElMessage.success('里程碑已跳过')
    skipDialogVisible.value = false
    // 刷新里程碑数据
    await loadMilestones()
  } catch (error) {
    ElMessage.error('跳过失败：' + error.message)
  } finally {
    skipSubmitting.value = false
  }
}
```

---

## 4. 各里程碑具体优化点

### 4.1 揭榜征集里程碑（BIDDING）

**优化点**：
1. 显示申请列表（多个申请者时）
2. 申请详情弹窗：显示申请者完整信息、申请理由、团队信息
3. 操作按钮：`通过申请`、`拒绝申请`
4. 拒绝时必填拒绝原因

**代码示例**：
```vue
<!-- 申请列表 -->
<div v-if="milestone.code === 'BIDDING' && milestone.applications?.length > 0" class="applications-list">
  <div 
    v-for="app in milestone.applications" 
    :key="app.id"
    class="application-item"
  >
    <div class="application-header">
      <span class="applicant-name">{{ app.applicantName }}</span>
      <el-tag :type="app.status === 'pending' ? 'warning' : app.status === 'approved' ? 'success' : 'danger'">
        {{ app.status === 'pending' ? '待审核' : app.status === 'approved' ? '已通过' : '已拒绝' }}
      </el-tag>
    </div>
    <p class="application-reason">{{ truncateText(app.reason, 50) }}</p>
    <div class="application-actions">
      <el-button type="text" size="small" @click="viewApplicationDetail(app)">
        查看详情
      </el-button>
      <el-button 
        v-if="app.status === 'pending'"
        type="success" 
        size="small"
        @click="openReviewDialog(milestone, '通过', app)"
      >
        通过
      </el-button>
      <el-button 
        v-if="app.status === 'pending'"
        type="danger" 
        size="small"
        @click="openReviewDialog(milestone, '拒绝', app)"
      >
        拒绝
      </el-button>
    </div>
  </div>
</div>
```

---

### 4.2 方案提交里程碑（PROPOSAL_SUBMIT）

**优化点**：
1. 显示方案概览（标题、技术栈、实施计划概述）
2. 审核按钮：`审核方案`
3. 审核结果：`通过` / `驳回` / `要求修改`
4. 支持查看历史版本对比

**代码示例**：
```vue
<!-- 方案提交摘要 -->
<div v-if="milestone.code === 'PROPOSAL_SUBMIT' && milestone.submissionSummary" class="proposal-summary">
  <div class="summary-row">
    <span class="label">方案标题：</span>
    <span>{{ milestone.submissionSummary.title }}</span>
  </div>
  <div class="summary-row">
    <span class="label">技术栈：</span>
    <el-tag 
      v-for="tech in milestone.submissionSummary.techStack" 
      :key="tech"
      size="small"
      style="margin-right: 8px"
    >
      {{ tech }}
    </el-tag>
  </div>
  <div class="summary-row">
    <span class="label">提交时间：</span>
    <span>{{ milestone.submissionSummary.submitTime }}</span>
  </div>
</div>
```

---

### 4.3 中期答辩里程碑（MIDTERM_DEFENSE）

**优化点**：
1. 显示答辩材料类型和提交时间
2. 操作按钮：`进入中期答辩`（跳转评审页）或 `跳过此里程碑`
3. 评审结果：`通过` / `不通过`
4. 支持填写亮点、问题、整改要求

**代码示例**：
```vue
<!-- 中期答辩操作区 -->
<div v-if="milestone.code === 'MIDTERM_DEFENSE' && isPublisher" class="midterm-actions">
  <el-button 
    v-if="milestone.status === 'in-progress'"
    type="primary"
    @click="goToMidtermReview(milestone)"
  >
    <el-icon><EditPen /></el-icon>
    进入中期答辩
  </el-button>
  <el-button 
    v-if="canSkipMilestone(milestone)"
    type="warning"
    @click="openSkipDialog(milestone)"
  >
    <el-icon><Remove /></el-icon>
    跳过此里程碑
  </el-button>
</div>
```

---

### 4.4 成果提交里程碑（FINAL_DELIVERY）

**优化点**：
1. 显示成果概览（标题、交付物类型、部署地址）
2. 审核按钮：`审核成果`
3. 支持分步骤验收（功能/文档/部署）
4. 审核结果：`通过` / `需修订`

---

### 4.5 成果评审里程碑（FINAL_REVIEW）

**优化点**：
1. 显示成果信息（只读）
2. 操作按钮：`开始评审`
3. 评审结果：`通过` / `不通过`
4. 支持多轮评审（多次提交评审意见）

---

### 4.6 结算支付里程碑（PAYMENT）

**优化点**：
1. 显示支付信息（项目奖金、实际支付金额）
2. 操作按钮序列：`确认支付金额` → `发起支付` → `确认到账` → `上传发票`
3. 每个操作都需要记录到审核历史
4. 关键操作需要二次确认

**代码示例**：
```vue
<!-- 结算支付操作区 -->
<div v-if="milestone.code === 'PAYMENT' && isPublisher" class="payment-actions">
  <el-steps :active="paymentStep" finish-status="success" align-center>
    <el-step title="确认金额" />
    <el-step title="发起支付" />
    <el-step title="确认到账" />
    <el-step title="上传发票" />
  </el-steps>
  
  <div class="payment-buttons">
    <el-button 
      v-if="paymentStep === 0"
      type="primary"
      @click="openPaymentAmountDialog(milestone)"
    >
      确认支付金额
    </el-button>
    <el-button 
      v-if="paymentStep === 1"
      type="success"
      @click="initiatePayment(milestone)"
    >
      发起支付
    </el-button>
    <el-button 
      v-if="paymentStep === 2"
      type="success"
      @click="confirmPaymentReceived(milestone)"
    >
      确认到账
    </el-button>
    <el-button 
      v-if="paymentStep === 3"
      type="default"
      @click="uploadInvoice(milestone)"
    >
      上传发票
    </el-button>
  </div>
</div>
```

---

### 4.7 结项公示里程碑（ANNOUNCEMENT）

**优化点**：
1. 显示公示内容（标题、正文、附件）
2. 操作按钮序列：`上传公示内容` → `设置公示期` → `开始公示`
3. 开始公示需要二次确认
4. 公示期结束后自动完成

---

## 5. 数据结构扩展

### 5.1 里程碑数据模型扩展

```javascript
{
  id: 'milestone-001',
  code: 'PROPOSAL_SUBMIT',
  title: '方案提交',
  status: 'in-progress', // 'pending' | 'in-progress' | 'completed' | 'skipped'
  
  // 新增：承接方提交摘要
  submissionSummary: {
    version: 1, // 提交版本号
    submitTime: '2025-11-27 10:30:00',
    submitterName: '承接方名称',
    // 根据里程碑类型不同，包含不同字段
    title: '方案标题', // 方案提交
    techStack: ['Vue3', 'Node.js'], // 方案提交
    applicantName: '申请者姓名', // 揭榜征集
    reason: '申请理由', // 揭榜征集
    hasHistory: true // 是否有历史版本
  },
  
  // 新增：承接方提交详情（完整内容）
  submissionDetail: {
    // 根据里程碑类型包含完整提交内容
  },
  
  // 新增：审核历史记录
  reviewHistory: [
    {
      reviewId: 'review-001',
      reviewerId: 'enterprise-001',
      reviewerName: '发布方名称',
      reviewTime: '2025-11-27 11:00:00',
      reviewResult: '要求修改', // '通过' | '驳回' | '要求修改' | '不通过' | '需修订'
      reviewComment: '审核意见内容',
      attachments: [
        { name: '修改建议.pdf', url: '...', size: '1.2MB' }
      ],
      submissionVersion: 1,
      // 扩展字段
      highlights: '亮点总结', // 中期答辩
      issues: '问题清单', // 中期答辩
      rectificationRequirements: '整改要求', // 中期答辩
      stepReviews: { // 成果提交
        function: '通过',
        document: '需修订',
        deployment: '通过'
      }
    }
  ],
  
  // 原有字段保持不变
  plannedDate: '2025-11-20',
  actualDate: null,
  deliverables: [],
  // ...
}
```

### 5.2 审核表单数据模型

```javascript
const reviewForm = ref({
  reviewResult: '', // 审核结果
  reviewComment: '', // 审核意见（必填）
  attachments: [], // 附件列表
  notifyBidder: true, // 是否提醒承接方
  
  // 扩展字段（根据里程碑类型）
  highlights: '', // 亮点总结（中期答辩）
  issues: '', // 问题清单（中期答辩）
  rectificationRequirements: '', // 整改要求（中期答辩）
  specificEvaluation: '', // 具体评价（成果评审）
  stepReviews: { // 分步骤验收（成果提交）
    function: '',
    document: '',
    deployment: ''
  },
  
  // 结算支付相关
  paymentAmount: 0, // 支付金额
  adjustmentReason: '', // 调整说明
  
  // 结项公示相关
  announcementTitle: '', // 公示标题
  announcementContent: '', // 公示内容
  announcementPeriod: 7 // 公示期天数
})
```

---

## 6. API接口需求

### 6.1 审核相关接口

```javascript
// 提交审核
POST /api/projects/:projectId/milestones/:milestoneId/review
Request: {
  reviewResult: '通过' | '驳回' | '要求修改' | '不通过' | '需修订',
  reviewComment: string,
  attachments: File[],
  // 扩展字段...
}
Response: {
  code: 200,
  data: {
    reviewId: 'review-001',
    milestoneStatus: 'completed' | 'pending' | 'in-progress'
  }
}

// 获取审核历史
GET /api/projects/:projectId/milestones/:milestoneId/review-history
Response: {
  code: 200,
  data: {
    reviewHistory: ReviewRecord[]
  }
}

// 跳过里程碑
POST /api/projects/:projectId/milestones/:milestoneId/skip
Request: {
  skipReason: string
}
Response: {
  code: 200,
  data: {
    milestoneStatus: 'skipped'
  }
}
```

### 6.2 提交内容相关接口

```javascript
// 获取承接方提交详情
GET /api/projects/:projectId/milestones/:milestoneId/submission
Response: {
  code: 200,
  data: {
    submissionDetail: SubmissionDetail,
    submissionHistory: SubmissionVersion[]
  }
}

// 获取承接方提交摘要
GET /api/projects/:projectId/milestones/:milestoneId/submission-summary
Response: {
  code: 200,
  data: {
    submissionSummary: SubmissionSummary
  }
}
```

---

## 7. 实施计划

### 7.1 开发阶段划分

**第一阶段：基础功能（1-2天）**
1. 角色判断逻辑扩展（`isPublisher`、`isBidder`）
2. 里程碑卡片结构重构
3. 发布方操作区基础框架
4. 状态标签支持 `skipped`

**第二阶段：审核功能（2-3天）**
1. 审核弹窗设计与实现
2. 审核表单与验证
3. 审核历史记录展示
4. 审核接口对接

**第三阶段：各里程碑优化（2-3天）**
1. 揭榜征集：申请列表、通过/拒绝
2. 方案提交：方案审核
3. 中期答辩：评审页、跳过功能
4. 成果提交：分步骤验收
5. 成果评审：评审功能
6. 结算支付：支付流程
7. 结项公示：公示流程

**第四阶段：优化与测试（1-2天）**
1. UI/UX优化
2. 交互体验优化
3. 边界情况处理
4. 回归测试

### 7.2 关键实现点

1. **角色区分**：使用 `v-if="isPublisher"` 和 `v-if="isBidder"` 严格区分显示内容
2. **状态管理**：审核后及时更新里程碑状态，触发页面刷新
3. **二次确认**：关键操作使用 `ElMessageBox.confirm` 进行二次确认
4. **数据同步**：审核后调用接口更新，然后刷新里程碑列表
5. **错误处理**：所有接口调用都要有错误处理和用户提示

### 7.3 注意事项

1. **向后兼容**：保持承接方原有功能不变
2. **权限控制**：前后端都要进行权限校验
3. **性能优化**：审核历史按需加载，使用折叠面板
4. **用户体验**：操作反馈及时，加载状态明确

---

**文档结束**